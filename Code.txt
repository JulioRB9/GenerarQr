Function GenerateQR(qrcode_value As String) As String

    Dim URL As String
    Dim My_Cell As Range
    Dim Pic As Picture
    
    ' Set the cell that calls the function
    Set My_Cell = Application.Caller
    
    ' Create the URL for the QR code image
    URL = "https://chart.googleapis.com/chart?chs=100x100&cht=qr&chl=" & qrcode_value
    
    ' Try to delete any existing QR code picture in the same cell
    On Error Resume Next
    ActiveSheet.Pictures("My_QR_CODE_" & My_Cell.Address(False, False)).Delete
    On Error GoTo 0
    
    ' Insert the new QR code picture
    Set Pic = ActiveSheet.Pictures.Insert(URL)
    With Pic
        .Name = "My_QR_CODE_" & My_Cell.Address(False, False)
        .Left = My_Cell.Left + 5
        .Top = My_Cell.Top + 5
    End With
    
    ' Return an empty string
    GenerateQR = ""
    
End Function
